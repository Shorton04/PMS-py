IF lv_locked_active = abap_true.

  CLEAR lv_in_window.

  " LKD must be inside window (JCDS)
  SELECT udate, utime
    INTO ( @lv_sts_date, @lv_sts_time )
    FROM jcds
    WHERE objnr = @ps_order-objnr
      AND stat  = 'I0043'
      AND inact = ''
    ORDER BY udate DESCENDING utime DESCENDING
    UP TO 1 ROWS.
  ENDSELECT.

  " Outside window â†’ ignore
  IF sy-subrc <> 0
     OR lv_sts_date < so_date-low
     OR ( lv_sts_date = so_date-low AND lv_sts_time < so_time-low ).
    RETURN.
  ENDIF.

  lv_in_window = abap_true.


ELSEIF lv_teco_active = abap_true.

  CLEAR lv_in_window.

  " TECO must be inside window (JCDS)
  SELECT udate, utime
    INTO ( @lv_sts_date, @lv_sts_time )
    FROM jcds
    WHERE objnr = @ps_order-objnr
      AND stat  = 'I0045'
      AND inact = ''
    ORDER BY udate DESCENDING utime DESCENDING
    UP TO 1 ROWS.
  ENDSELECT.

  IF sy-subrc <> 0
     OR lv_sts_date < so_date-low
     OR ( lv_sts_date = so_date-low AND lv_sts_time < so_time-low ).
    RETURN.
  ENDIF.

  lv_in_window = abap_true